<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:ICNX.App.ViewModels"
             xmlns:materialIcons="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
             x:Class="ICNX.App.Views.Controls.DownloadSessionCard"
             x:DataType="vm:DownloadSessionViewModel">

    <Border Background="{DynamicResource SurfaceCardBrush}" 
            BorderBrush="{DynamicResource BorderDefaultBrush}"
            BorderThickness="1"
            CornerRadius="8"
            Padding="12"
            Margin="0,0,0,8"
            Effect="drop-shadow(0 2 8 #20000000)">
        
        <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="Auto,*,Auto">
            
            <!-- Main Content Row -->
            <Grid Grid.Row="0" Grid.ColumnSpan="3" ColumnDefinitions="Auto,*,Auto">
                
                <!-- Session Icon + Info -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
                    <!-- Compact Icon -->
                    <Border Background="{Binding StatusColor}" 
                            CornerRadius="6" 
                            Width="28" 
                            Height="28">
                        <materialIcons:MaterialIcon Kind="Download" 
                                                   Width="14" 
                                                   Height="14"
                                                   Foreground="White"
                                                   HorizontalAlignment="Center" 
                                                   VerticalAlignment="Center"/>
                    </Border>
                    
                    <!-- Session Details -->
                    <StackPanel Spacing="1">
                        <TextBlock Text="{Binding Title}" 
                                   FontSize="13" 
                                   FontWeight="Medium" 
                                   Foreground="{DynamicResource TextPrimaryBrush}"
                                   TextTrimming="CharacterEllipsis"
                                   MaxWidth="300"/>
                        <TextBlock Text="{Binding ProgressText}" 
                                   FontSize="10" 
                                   Foreground="{DynamicResource TextMutedBrush}"/>
                    </StackPanel>
                </StackPanel>
                
                <!-- Status Badge -->
                <Border Grid.Column="1" 
                        Background="{Binding StatusColor}" 
                        CornerRadius="10" 
                        Padding="6,2"
                        HorizontalAlignment="Left"
                        Margin="12,0,0,0"
                        VerticalAlignment="Center">
                    <TextBlock Text="{Binding StatusText}" 
                               FontSize="9" 
                               FontWeight="SemiBold" 
                               Foreground="White"/>
                </Border>
                
                <!-- Compact Controls (Top Right) -->
                <StackPanel Grid.Column="2" 
                            Orientation="Horizontal" 
                            Spacing="4" 
                            VerticalAlignment="Center">
                    
                    <!-- Pause Button -->
                    <Button Background="Transparent"
                            BorderThickness="0"
                            CornerRadius="4"
                            Padding="4"
                            Width="24"
                            Height="24"
                            IsVisible="{Binding CanPause}"
                            ToolTip.Tip="Pause Download">
                        <materialIcons:MaterialIcon Kind="Pause" 
                                                   Width="12" 
                                                   Height="12"
                                                   Foreground="{DynamicResource TextSecondaryBrush}"/>
                    </Button>
                    
                    <!-- Resume Button -->
                    <Button Background="Transparent"
                            BorderThickness="0"
                            CornerRadius="4"
                            Padding="4"
                            Width="24"
                            Height="24"
                            IsVisible="{Binding CanResume}"
                            ToolTip.Tip="Resume Download">
                        <materialIcons:MaterialIcon Kind="Play" 
                                                   Width="12" 
                                                   Height="12"
                                                   Foreground="{DynamicResource AccentPrimaryBrush}"/>
                    </Button>
                    
                    <!-- Cancel Button -->
                    <Button Background="Transparent"
                            BorderThickness="0"
                            CornerRadius="4"
                            Padding="4"
                            Width="24"
                            Height="24"
                            IsVisible="{Binding CanCancel}"
                            ToolTip.Tip="Cancel Download">
                        <materialIcons:MaterialIcon Kind="Close" 
                                                   Width="12" 
                                                   Height="12"
                                                   Foreground="#FFEF4444"/>
                    </Button>
                    
                    <!-- More Options -->
                    <Button Background="Transparent"
                            BorderThickness="0"
                            CornerRadius="4"
                            Padding="4"
                            Width="24"
                            Height="24"
                            ToolTip.Tip="More Options">
                        <materialIcons:MaterialIcon Kind="DotsVertical" 
                                                   Width="12" 
                                                   Height="12"
                                                   Foreground="{DynamicResource TextMutedBrush}"/>
                    </Button>
                </StackPanel>
            </Grid>
            
            <!-- Compact Progress Bar -->
            <Border Grid.Row="1" Grid.ColumnSpan="3" 
                    Background="{DynamicResource SurfaceBaseBrush}"
                    CornerRadius="2"
                    Height="4"
                    Margin="0,8,0,0">
                <Border Background="{DynamicResource AccentPrimaryBrush}"
                        CornerRadius="2"
                        HorizontalAlignment="Left"
                        Width="{Binding ProgressWidth}"/>
            </Border>
            
        </Grid>
        
    </Border>

</UserControl>